# Development overrides - automatically loaded with docker-compose up
# Adds: build contexts, depends_on, bind mounts, dev ports

services:
  # --- Databases (dev ports) ---
  postgres:
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./shared/db/postgres:/docker-entrypoint-initdb.d

  mongodb:
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
      - ./shared/db/mongo:/docker-entrypoint-initdb.d

  mysql:
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./shared/db/mysql:/docker-entrypoint-initdb.d

  redis:
    ports:
      - "6379:6379"

  # --- Application Services ---
  react-frontend:
    build:
      context: ./react
      dockerfile: Dockerfile
    ports:
      - "3000:80"
    depends_on:
      - nodejs-backend

  nodejs-backend:
    build:
      context: ./nodejs
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    depends_on:
      - mongodb
      - postgres
      - redis
    volumes:
      - ./nodejs:/app
      - /app/node_modules

  php-backend:
    build:
      context: ./php
      dockerfile: Dockerfile
    ports:
      - "8001:9000"
    depends_on:
      - mysql
    volumes:
      - ./php:/var/www/html

  nginx-php:
    image: nginx:alpine
    volumes:
      - ./php:/var/www/html
      - ./shared/nginx/php.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - php-backend
    networks:
      - app-network

  java-backend:
    build:
      context: ./java
      dockerfile: Dockerfile
    ports:
      - "8002:8080"
    depends_on:
      - postgres

  python-backend:
    build:
      context: ./python
      dockerfile: Dockerfile
    ports:
      - "8003:8000"
    depends_on:
      - postgres
      - redis
    volumes:
      - ./python:/app

  dotnet-backend:
    build:
      context: ./dotnet
      dockerfile: Dockerfile
    ports:
      - "8004:80"
    depends_on:
      - postgres
      - redis

  nestjs-backend:
    build:
      context: ./nestjs
      dockerfile: Dockerfile
    ports:
      - "8005:3000"
    depends_on:
      - postgres
      - redis
    volumes:
      - ./nestjs:/app
      - /app/node_modules

