# Production/Swarm overrides
# Usage: docker stack deploy -c docker-compose.yml -c docker-compose.prod.yml lab10

services:
  # --- Infrastructure ---
  nginx-lb:
    image: nginx:alpine
    ports:
      - "8080:80"
    configs:
      - source: nginx_config_v1
        target: /etc/nginx/nginx.conf
    networks:
      - app-network
    deploy:
      placement:
        constraints: [node.role == manager]

  # --- Application Services (production ports) ---
  react-frontend:
    deploy:
      replicas: 3

  nodejs-backend:
    deploy:
      replicas: 1

  php-backend:
    deploy:
      replicas: 1

  java-backend:
    deploy:
      replicas: 1

  python-backend:
    deploy:
      replicas: 1

  dotnet-backend:
    deploy:
      replicas: 1

  nestjs-backend:
    deploy:
      replicas: 1

configs:
  nginx_config_v1:
    file: ./nginx/nginx_v2.conf

networks:
  app-network:
    driver: overlay

